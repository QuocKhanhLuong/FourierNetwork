# =============================================================================
# EGM-Net Configuration File
# =============================================================================

preset: "sota"

model:
  name: "EGMNet"
  in_channels: 3
  num_classes: 4
  img_size: 256
  
  backbone:
    type: "hrnet_mamba"
    base_channels: 32
    num_stages: 4
    blocks_per_stage: 4
    low_res_multiplier: 2
    
  components:
    use_mamba: true
    mamba_depth: 2
    mamba_scan_dim: 64
    
    use_spectral: true
    spectral_threshold: 0.1
    
    use_dual_stream: true
    
  # NEW: Retinal Preprocessing (DoG)
  retinal:
    enabled: false
    type: "dog"  # "dog" or "on_off"
    scales: [[1.0, 2.0], [2.0, 4.0]]
    kernel_size: 15
    concat_original: true

heads:
  coarse:
    type: "constellation"
    embedding_dim: 2
    init_gamma: 1.0
    
  fine:
    type: "gabor"  # "gabor" (default), "shearlet" (new), "none"
    enabled: true
    hidden_dim: 256
    num_layers: 4
    num_frequencies: 64
    use_energy_gating: true
    
  # NEW: Shearlet-specific config
  shearlet:
    num_orientations: 8
    num_frequencies: 4
    hidden_dim: 256
    
  fusion:
    type: "energy_gated"
    temperature: 1.0

loss:
  dice_weight: 1.0
  ce_weight: 0.5
  focal_weight: 0.0
  focal_gamma: 2.0
  
  boundary_weight: 0.1
  spectral_weight: 0.0
  
  eye_opening:
    enabled: true
    weight: 0.05
    warmup_epochs: 10
    radius: 5
    
  consistency:
    enabled: true
    weight: 0.1

training:
  epochs: 100
  batch_size: 8
  learning_rate: 1e-4
  weight_decay: 1e-5
  optimizer: "adamw"
  scheduler: "cosine"
  
  point_sampling:
    enabled: true
    num_samples: 4096
    strategy: "uncertainty_energy"
    
  augmentation:
    random_flip: true
    random_rotation: true
    rotation_range: 15

inference:
  use_implicit: true
  output_scale: 1.0
  tta_enabled: false

# =============================================================================
# PRESETS REFERENCE:
# =============================================================================
# baseline:
#   - use_mamba: false, use_spectral: false
#   - fine.type: "none", coarse.type: "linear"
#   - retinal.enabled: false
#
# lite:
#   - use_mamba: false, use_spectral: false
#   - fine.type: "none", coarse.type: "constellation"
#   - retinal.enabled: false
#
# sota:
#   - use_mamba: true, use_spectral: true
#   - fine.type: "gabor", coarse.type: "constellation"
#   - retinal.enabled: false
#
# bio (NEW):
#   - use_mamba: true, use_spectral: true
#   - fine.type: "shearlet", coarse.type: "constellation"
#   - retinal.enabled: true
# =============================================================================
